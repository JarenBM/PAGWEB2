<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Productos - Chifa Bonsai</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- DataTables -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
    />

    <style>
      :root {
        --primary-red: #c62828;
        --primary-red-dark: #b71c1c;
        --accent-gold: #ffb74d;
        --dark-bg: #121212;
        --light-bg: #f8f5f0;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
      }

      .sidebar {
        min-height: 100vh;
        background: linear-gradient(180deg, var(--dark-bg) 0%, #2c1810 100%);
        color: white;
        padding: 0;
        position: fixed;
        width: 250px;
        z-index: 1000;
      }

      .sidebar-header {
        padding: 1.5rem;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-header h4 {
        margin: 0;
        color: var(--accent-gold);
        font-weight: 600;
      }

      .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 1rem 1.5rem;
        border-left: 4px solid transparent;
        transition: all 0.3s;
      }

      .nav-link:hover,
      .nav-link.active {
        color: white;
        background: rgba(198, 40, 40, 0.2);
        border-left-color: var(--primary-red);
      }

      .nav-link i {
        width: 20px;
        margin-right: 10px;
      }

      .main-content {
        margin-left: 250px;
        padding: 20px;
        min-height: 100vh;
      }

      .page-header {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .table-container {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .product-img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
      }

      .badge-stock {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
      }

      .badge-stock.low {
        background: #fff3cd;
        color: #856404;
      }

      .badge-stock.normal {
        background: #d1ecf1;
        color: #0c5460;
      }

      .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }

      .search-box {
        max-width: 300px;
      }

      .filter-badge {
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 70px;
        }

        .sidebar .nav-link span {
          display: none;
        }

        .sidebar .nav-link i {
          margin-right: 0;
          width: 100%;
          text-align: center;
        }

        .sidebar-header h4,
        .sidebar-header small {
          display: none;
        }

        .main-content {
          margin-left: 70px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h4><i class="fas fa-utensils me-2"></i>Chifa Bonsai</h4>
        <small>Panel de Administración</small>
      </div>

      <nav class="nav flex-column mt-3">
        <a class="nav-link" href="dashboard.html">
          <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
        </a>
        <a class="nav-link active" href="productos.html">
          <i class="fas fa-utensils"></i> <span>Productos</span>
        </a>
        <a class="nav-link" href="pedidos.html">
          <i class="fas fa-shopping-cart"></i> <span>Pedidos</span>
        </a>
        <a class="nav-link" href="usuarios.html">
          <i class="fas fa-users"></i> <span>Usuarios</span>
        </a>
        <a class="nav-link" href="reportes.html">
          <i class="fas fa-chart-bar"></i> <span>Reportes</span>
        </a>
        <a class="nav-link" href="configuracion.html">
          <i class="fas fa-cog"></i> <span>Configuración</span>
        </a>

        <div class="mt-auto p-3">
          <button class="btn btn-outline-danger btn-sm w-100" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> <span>Cerrar Sesión</span>
          </button>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h3 class="mb-1">
              <i class="fas fa-utensils me-2"></i>Gestión de Productos
            </h3>
            <p class="text-muted mb-0">
              Administra el menú y productos del restaurante
            </p>
          </div>
          <div>
            <button class="btn btn-primary" id="newProductBtn">
              <i class="fas fa-plus me-1"></i> Nuevo Producto
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mt-4">
          <div class="col-md-3 col-6">
            <div class="card border-0 bg-light">
              <div class="card-body py-3">
                <div class="d-flex align-items-center">
                  <div class="bg-primary text-white rounded p-3 me-3">
                    <i class="fas fa-hamburger"></i>
                  </div>
                  <div>
                    <h5 class="mb-0" id="totalProducts">0</h5>
                    <small class="text-muted">Total Productos</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 col-6">
            <div class="card border-0 bg-light">
              <div class="card-body py-3">
                <div class="d-flex align-items-center">
                  <div class="bg-success text-white rounded p-3 me-3">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <div>
                    <h5 class="mb-0" id="activeProducts">0</h5>
                    <small class="text-muted">Activos</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 col-6">
            <div class="card border-0 bg-light">
              <div class="card-body py-3">
                <div class="d-flex align-items-center">
                  <div class="bg-warning text-white rounded p-3 me-3">
                    <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <div>
                    <h5 class="mb-0" id="lowStockProductsCount">0</h5>
                    <small class="text-muted">Stock Bajo</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 col-6">
            <div class="card border-0 bg-light">
              <div class="card-body py-3">
                <div class="d-flex align-items-center">
                  <div class="bg-info text-white rounded p-3 me-3">
                    <i class="fas fa-tags"></i>
                  </div>
                  <div>
                    <h5 class="mb-0" id="totalCategories">0</h5>
                    <small class="text-muted">Categorías</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters and Search -->
      <div class="row mb-3">
        <div class="col-md-8">
          <div class="d-flex flex-wrap gap-2 mb-2">
            <span class="badge bg-secondary filter-badge" data-filter="all"
              >Todos</span
            >
            <span class="badge bg-success filter-badge" data-filter="active"
              >Activos</span
            >
            <span class="badge bg-danger filter-badge" data-filter="inactive"
              >Inactivos</span
            >
            <span class="badge bg-warning filter-badge" data-filter="low-stock"
              >Stock Bajo</span
            >
          </div>

          <div class="d-flex gap-2">
            <select
              class="form-select form-select-sm"
              id="categoryFilter"
              style="max-width: 200px"
            >
              <option value="all">Todas las categorías</option>
            </select>

            <select
              class="form-select form-select-sm"
              id="sortBy"
              style="max-width: 150px"
            >
              <option value="newest">Más recientes</option>
              <option value="oldest">Más antiguos</option>
              <option value="name-asc">Nombre A-Z</option>
              <option value="name-desc">Nombre Z-A</option>
              <option value="price-asc">Precio menor</option>
              <option value="price-desc">Precio mayor</option>
            </select>
          </div>
        </div>

        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input
              type="text"
              class="form-control"
              id="searchProducts"
              placeholder="Buscar productos..."
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="clearSearch"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Products Table -->
      <div class="table-container">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th width="250">Producto</th>
                <th>Estado</th>
                <th class="text-center">Stock</th>
                <th class="text-end">Precio</th>
                <th class="text-center">Tiempo</th>
                <th>Descripción</th>
                <th class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody id="productsTableBody">
              <!-- Cargado por JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-3">
          <ul class="pagination justify-content-center" id="productsPagination">
            <!-- Cargado por JavaScript -->
          </ul>
        </nav>
      </div>
    </div>

    <!-- Modal Producto -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Nuevo Producto</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form id="productForm" novalidate>
            <input type="hidden" id="productId" />
            <input type="hidden" id="imageUrl" />

            <div class="modal-body">
              <div class="row">
                <div class="col-md-8">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Nombre del Producto *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="productName"
                        required
                      />
                      <div class="invalid-feedback">El nombre es requerido</div>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Slug (URL)</label>
                      <input
                        type="text"
                        class="form-control"
                        id="productSlug"
                      />
                      <small class="text-muted"
                        >Se genera automáticamente si se deja vacío</small
                      >
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Precio (S/.) *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="productPrice"
                        step="0.01"
                        min="0"
                        required
                      />
                      <div class="invalid-feedback">El precio es requerido</div>
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Stock *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="productStock"
                        min="0"
                        required
                      />
                      <div class="invalid-feedback">El stock es requerido</div>
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Stock Mínimo</label>
                      <input
                        type="number"
                        class="form-control"
                        id="productMinStock"
                        min="0"
                        value="5"
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Categoría</label>
                      <select class="form-select" id="productCategory">
                        <option value="">Sin categoría</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label"
                        >Tiempo de Preparación (min)</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="productPrepTime"
                        min="1"
                        value="15"
                      />
                    </div>

                    <div class="col-12">
                      <label class="form-label">Descripción Corta</label>
                      <textarea
                        class="form-control"
                        id="productShortDesc"
                        rows="2"
                        maxlength="100"
                      ></textarea>
                      <small class="text-muted">Máximo 100 caracteres</small>
                    </div>

                    <div class="col-12">
                      <label class="form-label">Descripción Completa</label>
                      <textarea
                        class="form-control"
                        id="productDesc"
                        rows="3"
                      ></textarea>
                    </div>

                    <div class="col-12">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="productActive"
                          checked
                        />
                        <label class="form-check-label" for="productActive">
                          Producto activo (visible para clientes)
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card">
                    <div class="card-body">
                      <label class="form-label">Imagen del Producto</label>
                      <div class="mb-3">
                        <input
                          type="file"
                          class="form-control"
                          id="productImage"
                          accept="image/*"
                        />
                        <small class="text-muted"
                          >JPEG, PNG o WebP (max 5MB)</small
                        >
                      </div>

                      <div id="productImagePreview" class="text-center mb-3">
                        <div class="border rounded p-4 bg-light">
                          <i class="fas fa-utensils fa-3x text-muted"></i>
                          <p class="text-muted mt-2 mb-0">Sin imagen</p>
                        </div>
                      </div>

                      <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Las imágenes ayudan a aumentar las ventas
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
              <button type="button" class="btn btn-primary" id="saveProductBtn">
                <i class="fas fa-save me-1"></i> Guardar Producto
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery (necesario para DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script type="module" src="../../js/admin/productos-admin.js"></script>
    <!-- Nuestros módulos -->
  </body>
</html>
